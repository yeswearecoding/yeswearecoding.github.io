
<!DOCTYPE html>
<html lang="fr">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://www.bittenbypython.com/theme/stylesheet/style.min.css">

  <!-- PrismJS -->
  <!-- <link rel="stylesheet" type="text/css" href="http://www.bittenbypython.com/theme/stylesheet/prism.min.css"> -->
  <!-- <script src="http://www.bittenbypython.com/theme/js/prism.js" type="text/javascript"></script> -->

  <link rel="stylesheet" type="text/css" href="http://www.bittenbypython.com/theme/pygments/perldoc.min.css">
  <link rel="stylesheet" type="text/css" href="http://www.bittenbypython.com/theme/font-awesome/css/font-awesome.min.css">



    <link href="http://www.bittenbypython.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Bitten By Python RSS">


  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="YesWeAreCoding" />
<meta name="description" content="Mettre en oeuvre MicroPython sur un ESP32 facilement" />
<meta name="keywords" content="micropython, esp32">
<meta property="og:site_name" content="Bitten By Python"/>
<meta property="og:title" content="A la d√©couverte de MicroPython sur ESP32"/>
<meta property="og:description" content="Mettre en oeuvre MicroPython sur un ESP32 facilement"/>
<meta property="og:locale" content="fr_FR"/>
<meta property="og:url" content="http://www.bittenbypython.com/decouverte-micropython-esp32.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-08-24 07:51:00+02:00"/>
<meta property="article:modified_time" content="2018-08-24 07:51:00+02:00"/>
<meta property="article:author" content="http://www.bittenbypython.com/author/yeswearecoding.html">
<meta property="article:section" content="embarqu√©"/>
<meta property="article:tag" content="micropython"/>
<meta property="article:tag" content="esp32"/>
<meta property="og:image" content="theme/img/ninja.png">

  <title>Bitten By Python &ndash; A la d√©couverte de MicroPython sur ESP32</title>

</head>

<body>
  <aside>
    <div>
      <a href="http://www.bittenbypython.com">
        <img src="theme/img/ninja.png" alt="Bitten By Python" title="Bitten By Python">
      </a>
      <h1><a href="http://www.bittenbypython.com">Bitten By Python</a></h1>



      <ul class="social">
        <li><a class="sc-envelope-o" href="mailto:yeswearecoding@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-github" href="https://github.com/yeswearecoding" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="http://www.bittenbypython.com/feeds/all.rss.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>

      <!-- Paypal -->
      <br>
      <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="hosted_button_id" value="EL23B43KWBU84">
        <input type="image" src="https://www.paypalobjects.com/fr_FR/FR/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal, le r√©flexe s√©curit√© pour payer en ligne">
        <img alt="" border="0" src="https://www.paypalobjects.com/fr_FR/i/scr/pixel.gif" width="1" height="1">
        </form>
        
      
    </div>


  </aside>
  <main>



<article class="single">
  <header>
    <h1 id="decouverte-micropython-esp32">A la d√©couverte de MicroPython sur ESP32</h1>
    <p>
          Posted on Ven 24 ao√ªt 2018 in <a href="http://www.bittenbypython.com/category/embarque.html">embarqu√©</a>


    </p>
  </header>


  <div>

    <!-- Mailjet -->

    <data data-token="25119b9c747c0fd253316a997703757e" class="mj-w-data" data-apikey="2Nqj" data-w-id="5ih" data-lang="fr_FR" data-base="https://app.mailjet.com" data-width="640" data-height="410" data-statics="statics"></data>

    <div class="mj-w-button mj-w-btn" data-token="25119b9c747c0fd253316a997703757e" style="font-family: Ubuntu, Helvetica; color: white; padding: 0 25px; background-color: #f0622b; text-align: center; vertical-align: middle; display: inline-block; border-radius: 3px; margin: 0 auto;">
        <div style="display: table; height: 45px;">
            <div style="display: table-cell; vertical-align: middle;">
                <div class="mj-w-button-content" style="font-family:Ubuntu, Helvetica; display: inline-block; text-align: center; font-size: 13px; vertical-align: middle;"><b>ABONNEZ-VOUS √Ä LA NEWSLETTER !</b></div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://app.mailjet.com/statics/js/widget.modal.js"></script>

    <!-- End Mailjet -->

    <p>Hello ! Comme c'est les vacances et qu'il faut bien s'occuper (#geeker) un peu, j'ai jou√© un peu avec <a href="http://micropython.org/">MicroPython</a> sur un microcontr√¥leur de type ESP32. Je me suis bas√© sur la lecture de <a href="https://amzn.to/2PBEEIv">Programmer en MicroPython</a>, qui est le seul livre en fran√ßais sur le sujet. Bon, il y en 2-3 de plus en anglais, mais rien de folichon non plus... <br />
Pour le mat√©riel, j'ai utilis√© ma carte <a href="https://amzn.to/2PAWV8O">ESP32 Gateway de chez Olimex</a> que j'avais sous la main.<br />
Voyons voir ce que l'on peut faire avec tout √ßa! üïµÔ∏è‚Äç‚ôÇÔ∏è</p>
<hr />
<p>Sommaire</p>
<div class="toc">
<ul>
<li><a href="#presentation-de-micropython">Pr√©sentation de MicroPython</a></li>
<li><a href="#installation-du-firmware">Installation du firmware</a><ul>
<li><a href="#prerequis">Pr√©requis</a><ul>
<li><a href="#drivers-usbserie">Drivers USB/s√©rie</a></li>
<li><a href="#screen">Screen</a></li>
</ul>
</li>
<li><a href="#creer-un-environnement-virtuel">Cr√©er un environnement virtuel</a></li>
<li><a href="#flasher-sa-carte">Flasher sa carte</a><ul>
<li><a href="#recuperer-le-dernier-firmware">R√©cup√©rer le dernier firmware</a></li>
<li><a href="#effacer-la-memoire-du-microcontroleur">Effacer la m√©moire du microcontr√¥leur</a></li>
<li><a href="#flasher-sa-carte_1">Flasher sa carte</a></li>
<li><a href="#se-connecter-au-shell-micropython">Se connecter au shell MicroPython</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#premier-test">Premier test</a><ul>
<li><a href="#principe">Principe</a></li>
<li><a href="#datasheet">Datasheet</a></li>
<li><a href="#faire-changer-detat-a-une-broche">Faire changer d'√©tat √† une broche</a></li>
<li><a href="#assemblage-du-tout">Assemblage du tout</a></li>
<li><a href="#utiliser-les-fichiers">Utiliser les fichiers</a><ul>
<li><a href="#lister-les-fichiers">Lister les fichiers</a><ul>
<li><a href="#simplifier-ampy">Simplifier ampy</a></li>
</ul>
</li>
<li><a href="#recuperer-un-fichier">R√©cup√©rer un fichier</a></li>
<li><a href="#uploader-un-fichier">Uploader un fichier</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>
<hr />
<h1 id="presentation-de-micropython">Pr√©sentation de MicroPython</h1>
<p>Il s'agit d'un projet lanc√© en 2013 sur Kickstarter pour financer le portage d'une version l√©g√®re de Python sur des microcontr√¥leurs. Enthousiasme de la communaut√©, les objectifs de la campagne sont largement d√©pass√©es et le projet est finalis√©. Il est associ√© √† un mat√©riel sp√©cifiquement d√©velopp√© pour ce syst√®me, la <a href="https://amzn.to/2BFE0Xu">PyBoard</a>, qui comporte plein d'entr√©es/sorties (des GPIO, comme sur les Raspberry) et qui est pleinement support√©e par le projet.<br />
Plusieurs autres cartes sont support√©es : <a href="https://amzn.to/2PDvGue">WiPy de chez Pycom</a>, les ESP8266, les ESP32, des cartes √† base de STM32 comme la NUCLEO-F401RE, la <a href="https://amzn.to/2N9kfsq">NUCLEO-F767ZI</a>, la <a href="https://amzn.to/2MPhOhN">NUCLEO-L476RG</a> ou bien encore la <a href="https://amzn.to/2o6SE0d">Espruino Pico</a>. Bref, il y a du choix ma petite dame !<br />
Et maintenant, c'est le moment de se retrousser les manches et de mettre les mains dans le camboui !<br />
üí™</p>
<h1 id="installation-du-firmware">Installation du firmware</h1>
<h2 id="prerequis">Pr√©requis</h2>
<h3 id="drivers-usbserie">Drivers USB/s√©rie</h3>
<p>Les cartes microcontr√¥leur utilisent tr√®s g√©n√©ralement des convertisseur USB-s√©rie afin de les utiliser facilement depuis son PC. Mais cela n√©cessite l'installation des drivers associ√©s.<br />
Pour ma carte, c'est le CH340. Je suis sous Mac, j'ai utilis√© la m√©thode d'installation <em>via</em> Homebrew trouv√©e ici : <a href="https://github.com/adrianmihalko/ch340g-ch34g-ch34x-mac-os-x-driver">CH340G CH34G CH34X Mac OS X driver</a>. Une fois branch√©e votre carte, r√©cup√©rer le nom du point de montage (par exemple avec un <code>sudo dmesg | grep dev</code>). Pour moi, c'est <code>/dev/cu.wchusbserial1410</code> que j'utiliserai pour la suite de cet article, n'oubliez pas d'adapter √† votre cas (g√©n√©ralement <code>/dev/ttyUSB0</code> pour Linux, <code>COMx</code> (o√π x est un nombre) pour Windows).  </p>
<h3 id="screen">Screen</h3>
<p>Autre √©l√©ment, on aura besoin d'utiliser un shell √† travers une liaison s√©rie. Sous Linux ou Mac, assurez-vous d'avoir <code>screen</code> d'install√©. Petit rappel / guide de survie des commandes de cet outil :<br />
<code>Ctrl A</code> puis <code>Ctrl D</code> pour d√©tacher une session. Vous allez sortir de <code>screen</code> mais votre session sera toujours active. Vous pourrez la retrouver avec <code>screen -r</code>.<br />
Pour fermer une session : <code>Ctrl A</code> puis <code>:</code> puis <code>quit</code> (tapez entr√©e pour valider).</p>
<h2 id="creer-un-environnement-virtuel">Cr√©er un environnement virtuel</h2>
<p>Nous allons avoir besoin de plusieurs librairies en Python. Pour une meilleure organisation, je vous conseille (comme tout projet d'ailleur) de cr√©er un environnement virtuel d√©di√©.<br />
J'utilise <a href="https://pipenv.readthedocs.io/en/latest/">Pipenv</a> pour faire √ßa facilement et rapidement :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>mkdir micropython-esp32
<span style="color: #658b00">cd</span> micropython-esp32
pipenv install esptool adafruit-ampy
pipenv shell
</pre></div>


<p><code>esptool</code> permet d'effacer puis flasher un microcontr√¥leur, <code>adafruit-ampy</code> sert √† lister les fichiers pr√©sents, en r√©cup√©rer (<code>get</code>) ou en d√©poser (<code>put</code>).</p>
<p>Nous somme d√©sormais dans notre environnement virtuel avec les librairies qui vont bien. On peut passer √† la suite.</p>
<h2 id="flasher-sa-carte">Flasher sa carte</h2>
<p>Bon, les exemples que je donne sont valables (test√©s) avec ma carte mais devrait fonctionner (√† quelques adaptations mineures pr√®s) avec les autre carte.<br />
Pour la suite, on va r√©cup√©rer le firmware, effacer la m√©moire du microcontr√¥leur puis la r√©√©crire avec le MicroPython.</p>
<h3 id="recuperer-le-dernier-firmware">R√©cup√©rer le dernier firmware</h3>
<p>Tout se trouve sur la page <a href="http://micropython.org/download">Downloads</a>. R√©cup√©rez la version qui correspond √† votre mat√©riel. Pour la ESP32 Gateway de chez Olimex, c'est dans <strong>Firmware for ESP32 boards</strong> puis <strong>Standard firmware</strong>. Un coup de <code>wget</code>:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>wget http://micropython.org/resources/firmware/esp32-20180824-v1.9.4-479-g828f771e3.bin
</pre></div>


<h3 id="effacer-la-memoire-du-microcontroleur">Effacer la m√©moire du microcontr√¥leur</h3>
<p>On utilise la librairie <code>esptool</code> pour effacer la m√©moire de l'ESP32 :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>esptool.py --chip esp32 erase_flash
</pre></div>


<p>Il devrait trouver automatique le point de montage. Si ce n'√©tait pas le cas, vous pouvez le sp√©cifier avec l'option <code>--port</code>.<br />
Si vous avez des soucis, vous pouvez baisser la vitesse de transfert en utilisant <code>--baud 115200</code>.</p>
<h3 id="flasher-sa-carte_1">Flasher sa carte</h3>
<p>On peut maintenant charger le firmware. On utilise la commande suivante :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>esptool.py --chip esp32 --port /dev/cu.wchusbserial1410 write_flash -z 0x1000 esp32-20180824-v1.9.4-479-g828f771e3.bin
</pre></div>


<p>N'oubliez pas d'adapter le nom de firmware. Et en moins d'une minute, vous devriez obtenir quelque chose du genre :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>esptool.py v2.5.0
Serial port /dev/cu.wchusbserial1410
Connecting......
Chip is ESP32D0WDQ6 (revision <span style="color: #B452CD">1</span>)
Features: WiFi, BT, Dual Core
MAC: <span style="color: #B452CD">24</span>:0a:c4:0c:31:1c
Uploading stub...
Running stub...
Stub running...
Configuring flash size...
Auto-detected Flash size: 4MB
Compressed <span style="color: #B452CD">1053520</span> bytes to <span style="color: #B452CD">663112</span>...
Wrote <span style="color: #B452CD">1053520</span> bytes (<span style="color: #B452CD">663112</span> compressed) at 0x00001000 in <span style="color: #B452CD">59</span>.5 seconds (effective <span style="color: #B452CD">141</span>.7 kbit/s)...
Hash of data verified.

Leaving...
Hard resetting via RTS pin...
</pre></div>


<p>Pas d'erreur, on peut se connecter sur le shell de notre MicroPython fra√Æchement install√© !</p>
<h3 id="se-connecter-au-shell-micropython">Se connecter au shell MicroPython</h3>
<p>On utilise <code>screen</code>pour se connecter en lui donnant le point de montage et la vitesse de transmission (115200 bauds par d√©faut) :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>screen /dev/cu.wchusbserial1410 <span style="color: #B452CD">115200</span>
</pre></div>


<p>Et sous vos yeux √©bahis :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>I (<span style="color: #B452CD">389</span>) cpu_start: Single core mode
I (<span style="color: #B452CD">389</span>) heap_init: Initializing. RAM available <span style="color: #8B008B; font-weight: bold">for</span> dynamic allocation:
I (<span style="color: #B452CD">392</span>) heap_init: At 3FFAE6E0 len <span style="color: #B452CD">00001920</span> (<span style="color: #B452CD">6</span> KiB): DRAM
I (<span style="color: #B452CD">398</span>) heap_init: At 3FFC4F48 len 0001B0B8 (<span style="color: #B452CD">108</span> KiB): DRAM
I (<span style="color: #B452CD">405</span>) heap_init: At 3FFE0440 len 00003BC0 (<span style="color: #B452CD">14</span> KiB): D/IRAM
I (<span style="color: #B452CD">411</span>) heap_init: At 3FFE4350 len 0001BCB0 (<span style="color: #B452CD">111</span> KiB): D/IRAM
I (<span style="color: #B452CD">417</span>) heap_init: At <span style="color: #B452CD">40091448</span> len 0000EBB8 (<span style="color: #B452CD">58</span> KiB): IRAM
I (<span style="color: #B452CD">424</span>) cpu_start: Pro cpu start user code
I (<span style="color: #B452CD">218</span>) cpu_start: Starting scheduler on PRO CPU.
OSError: [Errno <span style="color: #B452CD">2</span>] ENOENT
MicroPython v1.9.4-479-g828f771e3 on <span style="color: #B452CD">2018</span>-08-21; ESP32 module with ESP32
Type <span style="color: #CD5555">&quot;help()&quot;</span> <span style="color: #8B008B; font-weight: bold">for</span> more information.
&gt;&gt;&gt;
</pre></div>


<p>F√©licitations ! ü§©</p>
<h1 id="premier-test">Premier test</h1>
<p>Evidemment, comme tout tuto sur de l'embarqu√© qui se respecte, on va faire clignoter une LED. Si vous avez d√©j√† touch√© √† l'Arduino, vous allez voir comme c'est similaire mais en plus simple gr√¢ce √† Python.</p>
<h2 id="principe">Principe</h2>
<p>Il est assez simple. Il va falloir savoir sur quel PIN notre LED est connect√© (on va trouver ce genre d'information dans la <em>datasheet</em> de la carte), comment la faire changer de niveau (bas = 0 = √©teint, haut = 1 = allum√©) puis trouver quelle fonction nous permet d'attendre entre chaque changement de niveau. Let's go ! ‚öôÔ∏è‚öôÔ∏è‚öôÔ∏è</p>
<h2 id="datasheet">Datasheet</h2>
<p>Un sch√©ma explicatif et des informations sur la carte sont disponible ici <a href="https://docs.zerynth.com/latest/official/board.zerynth.olimex_esp32gateway/docs/index.html">Olimex Esp32 Gateway</a>. Une image valant mille mots :
<img alt="Oh le beau sch√©ma" src="https://docs.zerynth.com/latest/_images/Olimex_ESP32_gateway_pin_comm.jpg" /></p>
<p>On peut voir la LED en haut √† gauche puis on la retrouve sur les GPIO comme √©tant connect√© √† la broche <code>D33</code> (le D est pour <em>digital</em> donc num√©rique).</p>
<h2 id="faire-changer-detat-a-une-broche">Faire changer d'√©tat √† une broche</h2>
<p>Il y a un module sp√©cifique pour cela : <code>machine</code> qui contient une fonction <code>Pin</code>. On peut ainsi d√©finir une broche et son sens (c'est √† dire si elle en sortie ou en entr√©e). Une LED est une sortie, on peut donc la d√©finir ainsi :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">machine</span> <span style="color: #8B008B; font-weight: bold">import</span> Pin

led = Pin(<span style="color: #B452CD">33</span>, Pin.OUT)
</pre></div>


<p>On pourra faire changer son √©tat gr√¢ce √† la m√©thode <code>value()</code> de notre LED (qui est du type <code>Pin</code>) avec <code>led.value(1)</code> pour un √©tat haut et <code>led.value(0)</code> pour un √©tat bas.</p>
<p>Pour attendre entre les deux √©tats, nous avons besoins d'un <code>sleep()</code>. Ici vous le trouverez dans la librairie <code>utime</code> (le <code>u</code> est pour micro). On l'utilise ainsi :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">utime</span> <span style="color: #8B008B; font-weight: bold">import</span> sleep_ms

sleep_ms(<span style="color: #B452CD">500</span>)
</pre></div>


<h2 id="assemblage-du-tout">Assemblage du tout</h2>
<p>On a du coup le code suivant :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">machine</span> <span style="color: #8B008B; font-weight: bold">import</span> Pin
<span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">utime</span> <span style="color: #8B008B; font-weight: bold">import</span> sleep_ms

led = Pin(<span style="color: #B452CD">33</span>, Pin.OUT)

<span style="color: #8B008B; font-weight: bold">while</span> <span style="color: #658b00">True</span>:
  led.value(<span style="color: #B452CD">1</span>)
  sleep_ms(<span style="color: #B452CD">500</span>)
  led.value(<span style="color: #B452CD">0</span>)
  sleep_ms(<span style="color: #B452CD">500</span>)
</pre></div>


<p>En copiant/collant ligne par ligne dans <code>screen</code>, vous pouvez tester ce code. Mais il y plus facile.</p>
<h2 id="utiliser-les-fichiers">Utiliser les fichiers</h2>
<p>Dans votre session MicroPython, vous pouvez taper le code suivant pour voir les fichiers pr√©sents par d√©faut sur l'ESP32 :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>&gt;&gt;&gt; import os
&gt;&gt;&gt; os.listdir()
[<span style="color: #CD5555">&#39;boot.py&#39;</span>]
</pre></div>


<p>Il n'y qu'un seul fichier. On va regarder son contenu.</p>
<h3 id="lister-les-fichiers">Lister les fichiers</h3>
<p>Sortez de votre session de <code>screen</code> pour utiliser l'outil <code>ampy</code> d'Adafruit. Sans √™tre dans une session de shell (elle doit √™tre ferm√©e sous peine d'erreur), cet outil permet de r√©cup√©rer la liste des fichiers pr√©sents :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>ampy --port /dev/cu.wchusbserial1410 --baud <span style="color: #B452CD">115200</span> -d <span style="color: #B452CD">2</span> ls
boot.py
</pre></div>


<p>L'option <code>--port</code>est pour notre point de montage, <code>--baud</code> pour la vitesse et <code>-d</code> pour ajouter un d√©lai. Sans ce d√©lai, j'avais toujours des erreurs. Cette derni√®re option ne sera peut-√™tre pas n√©cessaire pour vous, √† tester.</p>
<p>Le retour est notre liste de fichier, qui est bien identique √† ce que l'on a obtenu dans le shell python.</p>
<h4 id="simplifier-ampy">Simplifier ampy</h4>
<p>Si vous faites un <code>ampy --help</code>, vous pouvez voir que les options peuvent √™tre remplac√©es par des variables de shell. Ce que je vais faire ici pour me simplifier la t√¢che. Selon la doc, je peux donc faire (je suis dans un shell <code>zsh</code>, √† adapter au votre) :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #658b00">export</span> <span style="color: #00688B">AMPY_PORT</span>=/dev/cu.wchusbserial1410
<span style="color: #658b00">export</span> <span style="color: #00688B">AMPY_BAUD</span>=<span style="color: #B452CD">115200</span>
<span style="color: #658b00">export</span> <span style="color: #00688B">AMPY_DELAY</span>=<span style="color: #B452CD">2</span>
</pre></div>


<p>Ce qui simplifie ma commande par : <code>ampy ls</code>. C'est pas merveilleux ? ü§ó</p>
<h3 id="recuperer-un-fichier">R√©cup√©rer un fichier</h3>
<p>Maintenant que l'on a configurer <code>ampy</code>, rien de plus simple :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>ampy get boot.py &gt; boot.py
</pre></div>


<p>On notera la redirection de flux vers un fichier. En effet, par d√©faut ampy √©crit le r√©sultat directement dans le shell. On peu alors examiner le contenu de ce fichier :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #228B22"># This file is executed on every boot (including wake-boot from deepsleep)</span>
<span style="color: #228B22">#import esp</span>
<span style="color: #228B22">#esp.osdebug(None)</span>
<span style="color: #228B22">#import webrepl</span>
<span style="color: #228B22">#webrepl.start()</span>
</pre></div>


<p>Hey ! Que du code comment√© ! Rempla√ßons le par notre code √©crit plus haut pour faire clignoter notre LED. Une fois le fichier enregistr√©, nous allons pouvoir le pousser sur notre carte.</p>
<h3 id="uploader-un-fichier">Uploader un fichier</h3>
<p>On utilise l'option <code>put</code> de <code>ampy</code>, ce qui nous donne :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>ampy put boot.py
</pre></div>


<p>On fait alors un <code>reset</code>de la carte <em>via</em> le bouton <code>RST1</code>et .... Magie !!! üßô‚Äç‚ôÇÔ∏è</p>
<p>Si vous vous connectez avec <code>screen</code>, vous remarquerez que vous n'avez pas de shell. En effet, notre programme ne termine jamais, il ne rend donc pas la main. Pour revenir au shell, supprimez le <code>boot.py</code>de la carte puis r√©uploadez en un vide.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Vous, cette "petite" introduction est termin√©e, j'esp√®re qu'elle vous sera utile et que vous avez appris / eu envie de tester MicroPython !</p>
<p>N'h√©sitez pas √† me faire part de vos commentaires, pour ma part je vais poursuivre mes tests au fil du temps.</p>
<p>Ciao !!</p>
  </div>



  <div class="tag-cloud">
    <p>
      <a href="http://www.bittenbypython.com/tag/micropython.html">micropython</a>
      <a href="http://www.bittenbypython.com/tag/esp32.html">esp32</a>
    </p>
  </div>

  <div class="center social-share">
    <p>    Like this article? Share it with your friends!
</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
    <div class="addthis_inline_share_toolbox"></div>
  </div>



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'bittenbybypthon';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>
  &copy; YesWeAreCoding 2017 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-111329786-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a34c2ac2c1ffc84" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Bitten By Python ",
  "url" : "http://www.bittenbypython.com",
  "image": "theme/img/ninja.png",
  "description": "Un (autre) blog sur Python"
}
</script>
</body>
</html>