
<!DOCTYPE html>
<html lang="fr">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://www.bittenbypython.com/theme/stylesheet/style.min.css">

  <!-- PrismJS -->
  <!-- <link rel="stylesheet" type="text/css" href="http://www.bittenbypython.com/theme/stylesheet/prism.min.css"> -->
  <!-- <script src="http://www.bittenbypython.com/theme/js/prism.js" type="text/javascript"></script> -->

  <link rel="stylesheet" type="text/css" href="http://www.bittenbypython.com/theme/pygments/perldoc.min.css">
  <link rel="stylesheet" type="text/css" href="http://www.bittenbypython.com/theme/font-awesome/css/font-awesome.min.css">



    <link href="http://www.bittenbypython.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Bitten By Python RSS">


  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="YesWeAreCoding" />
<meta name="description" content="Utiliser les décorateurs efficacement" />
<meta name="keywords" content="python, design patterns, decorator">
<meta property="og:site_name" content="Bitten By Python"/>
<meta property="og:title" content="Comprendre les décorateurs"/>
<meta property="og:description" content="Utiliser les décorateurs efficacement"/>
<meta property="og:locale" content="fr_FR"/>
<meta property="og:url" content="http://www.bittenbypython.com/comprendre-decorateur.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-02-06 12:23:00+01:00"/>
<meta property="article:modified_time" content="2018-02-06 12:23:00+01:00"/>
<meta property="article:author" content="http://www.bittenbypython.com/author/yeswearecoding.html">
<meta property="article:section" content="design patterns"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="design patterns"/>
<meta property="article:tag" content="decorator"/>
<meta property="og:image" content="theme/img/ninja.png">

  <title>Bitten By Python &ndash; Comprendre les décorateurs</title>

</head>

<body>
  <aside>
    <div>
      <a href="http://www.bittenbypython.com">
        <img src="theme/img/ninja.png" alt="Bitten By Python" title="Bitten By Python">
      </a>
      <h1><a href="http://www.bittenbypython.com">Bitten By Python</a></h1>



      <ul class="social">
        <li><a class="sc-envelope-o" href="mailto:yeswearecoding@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-github" href="https://github.com/yeswearecoding" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="http://www.bittenbypython.com/feeds/all.rss.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>

      <!-- Paypal -->
      <br>
      <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="hosted_button_id" value="EL23B43KWBU84">
        <input type="image" src="https://www.paypalobjects.com/fr_FR/FR/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal, le réflexe sécurité pour payer en ligne">
        <img alt="" border="0" src="https://www.paypalobjects.com/fr_FR/i/scr/pixel.gif" width="1" height="1">
        </form>
        
      
    </div>


  </aside>
  <main>



<article class="single">
  <header>
    <h1 id="comprendre-decorateur">Comprendre les décorateurs</h1>
    <p>
          Posted on Mar 06 février 2018 in <a href="http://www.bittenbypython.com/category/design-patterns.html">design patterns</a>


    </p>
  </header>


  <div>

    <!-- Mailjet -->

    <data data-token="25119b9c747c0fd253316a997703757e" class="mj-w-data" data-apikey="2Nqj" data-w-id="5ih" data-lang="fr_FR" data-base="https://app.mailjet.com" data-width="640" data-height="410" data-statics="statics"></data>

    <div class="mj-w-button mj-w-btn" data-token="25119b9c747c0fd253316a997703757e" style="font-family: Ubuntu, Helvetica; color: white; padding: 0 25px; background-color: #f0622b; text-align: center; vertical-align: middle; display: inline-block; border-radius: 3px; margin: 0 auto;">
        <div style="display: table; height: 45px;">
            <div style="display: table-cell; vertical-align: middle;">
                <div class="mj-w-button-content" style="font-family:Ubuntu, Helvetica; display: inline-block; text-align: center; font-size: 13px; vertical-align: middle;"><b>ABONNEZ-VOUS À LA NEWSLETTER !</b></div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://app.mailjet.com/statics/js/widget.modal.js"></script>

    <!-- End Mailjet -->

    <p>Hello !</p>
<p>Vous avez peut-être déjà rencontré lors de la consultation de code écrit par quelqu'un d'autre la présence d'un <code>@</code> suivi d'un nom juste avant la définition d'une fonction et vous vous êtes posé la question "à quoi cela peut-il bien servir ?".</p>
<p>Voyons cela ensemble.</p>
<hr />
<p>Sommaire</p>
<div class="toc">
<ul>
<li><a href="#poser-les-bases">Poser les bases</a></li>
<li><a href="#appliquer">Appliquer</a></li>
<li><a href="#pour-aller-plus-loin">Pour aller plus loin</a></li>
</ul>
</div>
<hr />
<h1 id="poser-les-bases">Poser les bases</h1>
<p>En Python, les fonctions sont des <a href="https://fr.wikipedia.org/wiki/Objet_de_premi%C3%A8re_classe">Objet de première classe</a>, c'est à dire qu'elles se comporte comme n'importe quel objet.</p>
<p>Exemple :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #228B22"># une fonction de toute beauté</span>
<span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">ma_fonction</span>():
    <span style="color: #8B008B; font-weight: bold">print</span>(<span style="color: #CD5555">&#39;hello toto&#39;</span>)
</pre></div>


<p>Comme elle se comporte comme un objet, je peux la stocker dans une variable puis l’appeler en ajoutant les parenthèses lors de l'appel de ma variable :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>tata = ma_fonction
</pre></div>


<p>vérifions son type :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">print</span>(<span style="color: #658b00">type</span>(tata))

&lt;<span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #a61717; background-color: #e3d2d2">&#39;</span><span style="color: #008b45; font-weight: bold">function</span><span style="color: #CD5555">&#39;&gt;</span>
</pre></div>


<p>je peux donc l’appeler : (notez bien l'ajout des parenthèses)</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>tata()

hello toto
</pre></div>


<p>Magnifique. Génial. Bon, et on fait quoi maintenant que l'on sait ça ?</p>
<h1 id="appliquer">Appliquer</h1>
<p>Les décorateurs sont souvent définis par des fonctions qui prennent des fonctions en arguments et qui retournent des fonctions. C'est pas clair ? C'est normal :-). Voyons un exemple simple. Il faut juste se dire qu'un décorateur est quelque chose qui vient entourer une fonction (la décorer, telle l'artiste qui décore un vase pour vous donner une image).</p>
<p>Codons un décorateur qui a pour fonction de faire un <em>timer</em> pour savoir combien de temps la fonction décorée met à s'exécuter.</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">time</span>

<span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">timer</span>(une_fonction):
    <span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">osef</span>(parametres):
        debut = time.time()
        res = une_fonction(parametres)
        <span style="color: #8B008B; font-weight: bold">print</span>(<span style="color: #CD5555">&quot;On a mis {:.1f} secondes&quot;</span>.format(time.time()-debut))
        <span style="color: #8B008B; font-weight: bold">return</span> res
    <span style="color: #8B008B; font-weight: bold">return</span> osef
</pre></div>


<p>Définissons une fonction pour laquelle on souhaite connaitre son temps d'exécution :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #707a7c">@timer</span>
<span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">attendons</span>(secondes):
    <span style="color: #8B008B; font-weight: bold">for</span> el <span style="color: #8B008B">in</span> <span style="color: #658b00">range</span>(secondes):
        time.sleep(<span style="color: #B452CD">1</span>)
</pre></div>


<p>Puis vérifions notre résultat :</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>attendons(<span style="color: #B452CD">2</span>)

On a mis <span style="color: #B452CD">2.0</span> secondes
</pre></div>


<p>N'est-ce pas magnifique ? C'est merveilleux Jean-Pierre.</p>
<p>Plus sérieusement, nous avons vu comment on construit un décorateur assez simple et comment il s'utilise. Maintenant que vous avez vu le principe, vous pourrez développer les vôtres facilement !</p>
<p>Petite mise en garde : c'est comme tout, les décorateurs s'utilisent uniquement <strong>quand c'est utile !!</strong> Inutile d'étaler votre nouvelle connaissance juste pour le plaisir de coder :-) (bon, si un peu quand même histoire de s’entraîner).</p>
<h1 id="pour-aller-plus-loin">Pour aller plus loin</h1>
<p>Je vous laisse admirer un magnifique décorateur issu du code de <a href="https://bottlepy.org">Bottle</a> qui est un micro-framework Web qui tient en un seul fichier (j'adore) :</p>
<div class="gist">
    <script src='https://gist.github.com/4f62c0be5c1134e265b8dcc1b904268b.js'></script>
    <noscript>
        <pre><code>def route(self,
              path=None,
              method='GET',
              callback=None,
              name=None,
              apply=None,
              skip=None, **config):
        """ A decorator to bind a function to a request URL. Example::
                @app.route('/hello/<name>')
                def hello(name):
                    return 'Hello %s' % name
            The ``<name>`` part is a wildcard. See :class:`Router` for syntax
            details.
            :param path: Request path or a list of paths to listen to. If no
              path is specified, it is automatically generated from the
              signature of the function.
            :param method: HTTP method (`GET`, `POST`, `PUT`, ...) or a list of
              methods to listen to. (default: `GET`)
            :param callback: An optional shortcut to avoid the decorator
              syntax. ``route(..., callback=func)`` equals ``route(...)(func)``
            :param name: The name for this route. (default: None)
            :param apply: A decorator or plugin or a list of plugins. These are
              applied to the route callback in addition to installed plugins.
            :param skip: A list of plugins, plugin classes or names. Matching
              plugins are not installed to this route. ``True`` skips all.
            Any additional keyword arguments are stored as route-specific
            configuration and passed to plugins (see :meth:`Plugin.apply`).
        """
        if callable(path): path, callback = None, path
        plugins = makelist(apply)
        skiplist = makelist(skip)

        def decorator(callback):
            if isinstance(callback, basestring): callback = load(callback)
            for rule in makelist(path) or yieldroutes(callback):
                for verb in makelist(method):
                    verb = verb.upper()
                    route = Route(self, rule, verb, callback,
                                  name=name,
                                  plugins=plugins,
                                  skiplist=skiplist, **config)
                    self.add_route(route)
            return callback

        return decorator(callback) if callback else decorator</code></pre>
    </noscript>
</div>
<p>Les incontournables Sam et Max :</p>
<p><a href="http://sametmax.com/comprendre-les-decorateurs-python-pas-a-pas-partie-1/">Comprendre les décorateurs Python pas à pas (partie 1)</a><br />
<a href="http://sametmax.com/comprendre-les-decorateur-python-pas-a-pas-partie-2/">Comprendre les décorateurs Python pas à pas (partie 2)</a></p>
<p>Un article (en anglais) qui donne plus de détails et les bonnes pratiques :<br />
<a href="https://github.com/hchasestevens/hchasestevens.github.io/blob/master/notebooks/the-decorators-they-wont-tell-you-about.ipynb">The decorators they won't tell you about</a></p>
<p>Bon code !</p>
  </div>



  <div class="tag-cloud">
    <p>
      <a href="http://www.bittenbypython.com/tag/python.html">python</a>
      <a href="http://www.bittenbypython.com/tag/design-patterns.html">design patterns</a>
      <a href="http://www.bittenbypython.com/tag/decorator.html">decorator</a>
    </p>
  </div>

  <div class="center social-share">
    <p>    Like this article? Share it with your friends!
</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
    <div class="addthis_inline_share_toolbox"></div>
  </div>



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'bittenbybypthon';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>
  &copy; YesWeAreCoding 2017 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-111329786-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a34c2ac2c1ffc84" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Bitten By Python ",
  "url" : "http://www.bittenbypython.com",
  "image": "theme/img/ninja.png",
  "description": "Un (autre) blog sur Python"
}
</script>
</body>
</html>